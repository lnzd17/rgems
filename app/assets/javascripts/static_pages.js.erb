
$( document ).ready(function() {

  $('.star').click(function(){
    const starColor = $(this).data("color");
    const gemName = $(this).data("id");
    const gemUrl = $(this).data("url");
    if(starColor === "gray"){
      $(this).attr("src", "<%= asset_path( 'star-blue.png' ) %>");
      $(this).data("color", "blue");
      addToFavorites(gemName, gemUrl);
    }else{
      $(this).attr("src", "<%= asset_path( 'star-gray.png' ) %>");
      $(this).data("color", "gray");
      removeFromFavorites(gemName);
    }
  });

  function addToFavorites(gemName, gemUrl) {
    localStorage.setItem(gemName, gemUrl);
  }

  function removeFromFavorites(gemName){
    localStorage.removeItem(gemName);
    $('.favorites').children().each(function(){
      if($(this).text() == gemName){
        $(this).remove();
      }
    });
  }

  function rememberStarColor(){
    const favorites = [];
    for(var i = 0; i < localStorage.length; i++){
      favorites.push(localStorage.key(i));
    }
    $('.star').each(function(){
      if (favorites.includes($(this).data('id'))){
        $(this).attr("src", "<%= asset_path( 'star-blue.png' ) %>");
        $(this).data("color", "blue");
      }
    });
  }

  rememberStarColor();

});
